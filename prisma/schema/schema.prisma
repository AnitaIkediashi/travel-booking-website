// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL") // --- only needed when i want to do migrations and generate that's why the error ---
}

//creating the tables/models i need for my app

model Airport {
  airport_code      String    @id // PK
  airport_name      String
  image_url         String? // optional field
  city              String
  country           String
  departure_segment Segment[] @relation("DepartureSegment") // using a unique name for relation because a single Airport is related to Segment twice same goes for Legs model -- 1:M relation with Segment
  arrival_segment   Segment[] @relation("ArrivalSegment") // 1:M relation with Segment
  departure_leg     Legs[]    @relation("DepartureLegs") // 1:M relation with Legs
  arrival_legs      Legs[]    @relation("ArrivalLegs") // 1:M relation with Legs
}

model Data {
  id                       String                  @id @default(uuid()) // PK
  departure_intervals      DepartureInterval[] // 1:M relation
  duration_min             Int
  duration_max             Int
  short_layover_connection ShortLayoverConnection? // 1:1 relation
  min_price                MinPrice? // 1:1 relation
  baggage                  Baggage[] // 1:M relation
  cabin_class              String
  stops                    Stop[] // 1:M relation and also a relational list
  airlines                 Airlines[] // 1:M relation
  duration                 Duration[] // 1:M relation
  flight_times             FlightTimes[] // 1:M relation
  flight_offers            FlightOffers[] // 1:M relation
}

model DepartureInterval {
  id              Int    @id @default(autoincrement()) // PK
  interval_id     String // FK
  start           String
  end             String
  departureFlight Data   @relation(fields: [interval_id], references: [id], onDelete: Cascade) // relation to Data model the onDelete: Cascade ensures that if a Data record is deleted, all related DepartureInterval records are also deleted
}

model ShortLayoverConnection {
  id            Int    @id @default(autoincrement()) // PK
  layover_id    String @unique // FK -- those without ? are required fields
  count         Int? // ? means optional field
  layoverFlight Data   @relation(fields: [layover_id], references: [id], onDelete: Cascade) // relation to Data model the onDelete: Cascade ensures that if a Data record is deleted, all related ShortLayoverConnection records are also deleted
}

model MinPrice {
  id                   Int       @id @default(autoincrement()) // PK
  min_price_data_id    String    @unique // FK
  min_price_airline_id String?   @unique // FK
  min_price_stop_id    Int?      @unique // FK
  currency_code        String?
  amount               Int
  minPricePerFlight    Data      @relation(fields: [min_price_data_id], references: [id], onDelete: Cascade) // relation to Data model the onDelete: Cascade ensures that if a Data record is deleted, all related MinPrice records are also deleted
  minPricePerAirline   Airlines? @relation(fields: [min_price_airline_id], references: [id], onDelete: Cascade) // relation to Airlines model the onDelete: Cascade ensures that if a Data record is deleted, all related MinPrice records are also deleted
  minPricePerStop      Stop?     @relation(fields: [min_price_stop_id], references: [id], onDelete: Cascade) // relation to Stop model the onDelete: Cascade ensures that if a Data record is deleted, all related MinPrice records are also deleted
}

model Stop {
  id          Int       @id @default(autoincrement()) // PK
  stop_id     String // FK
  no_of_stops Int
  count       Int?
  stopCount   Data      @relation(fields: [stop_id], references: [id], onDelete: Cascade) // relation to Data model the onDelete: Cascade ensures that if a Data record is deleted, all related Stop records are also deleted
  min_price   MinPrice? // 1:1 relation
}

model Airlines {
  id            String    @id @default(uuid()) // PK
  airline_id    String // FK
  name          String
  logo          String
  iata_code     String
  min_price     MinPrice?
  airlineFlight Data      @relation(fields: [airline_id], references: [id], onDelete: Cascade)
}

model Duration {
  id             Int    @id @default(autoincrement()) // PK
  duration_id    String // FK
  min            Int
  max            Int
  durationFlight Data   @relation(fields: [duration_id], references: [id], onDelete: Cascade)
}

model Baggage {
  id            Int     @id @default(autoincrement()) // PK
  baggage_id    String // FK
  type          String
  included      Boolean
  weight        Int?
  param_name    String?
  baggageFlight Data    @relation(fields: [baggage_id], references: [id], onDelete: Cascade)
}

model FlightTimes {
  id                String    @id @default(uuid()) // PK
  flight_times_id   String // FK
  flight_times_data Data      @relation(fields: [flight_times_id], references: [id], onDelete: Cascade)
  arrival           Arrival[]
  depart            Depart[]
}

model Arrival {
  id            Int         @id @default(autoincrement()) // PK
  arrival_id    String // FK
  start         String
  end           String
  arrival_times FlightTimes @relation(fields: [arrival_id], references: [id], onDelete: Cascade) // relation to FlightTimes model the onDelete: Cascade ensures that if a flightTimes record is deleted, all related Arrival records are also deleted
}

model Depart {
  id           Int         @id @default(autoincrement()) // PK
  depart_id    String // FK
  start        String
  end          String
  depart_times FlightTimes @relation(fields: [depart_id], references: [id], onDelete: Cascade)
}

model FlightOffers {
  id                String            @id @default(uuid()) // PK
  flight_offer_id   String // FK
  price_id          Int? // FK
  token             String
  trip_type         String
  flight_key        String
  segments          Segment[]
  price_breakdown   PriceBreakdown?   @relation(fields: [price_id], references: [id])
  traveler_price    TravelerPrice[]
  seat_availability SeatAvailability?
  branded_fareinfo  BrandedFareInfo?
  FlightData        Data              @relation(fields: [flight_offer_id], references: [id], onDelete: Cascade)
}

model Segment {
  id                     Int          @id @default(autoincrement()) // PK
  segment_id             String // FK
  departure_airport_code String //FK
  arrival_airport_code   String //FK
  departure_airports     Airport      @relation("DepartureSegment", fields: [departure_airport_code], references: [airport_code]) // the need for unique relation names arises because a single Airport is related to Segment twice (same goes for Legs model) -- Disambiguating relations
  arrival_airports       Airport      @relation("ArrivalSegment", fields: [arrival_airport_code], references: [airport_code])
  departure_time         DateTime 
  arrival_time           DateTime
  total_time             Int
  legs                   Legs[]
  segmentData            FlightOffers @relation(fields: [segment_id], references: [id], onDelete: Cascade)

  //index the departure_time for faster queries and faster cpu performance -- its like sorting in advance or like map the data based on departure_time
  @@index([departure_time])
}

model Legs {
  id                     Int         @id @default(autoincrement()) // PK
  leg_id                 Int // FK
  departure_airport_code String //FK
  arrival_airport_code   String //FK
  departure_time         DateTime
  arrival_time           DateTime
  cabin_class            String?
  total_time             Int
  departure_airport      Airport     @relation("DepartureLegs", fields: [departure_airport_code], references: [airport_code])
  arrival_airport        Airport     @relation("ArrivalLegs", fields: [arrival_airport_code], references: [airport_code])
  carriers               Carriers[]
  flight_info            FlightInfo?
  legSegment             Segment     @relation(fields: [leg_id], references: [id], onDelete: Cascade)
}

model Carriers {
  id         Int    @id @default(autoincrement()) // PK
  carrier_id Int // FK
  name       String
  logo       String
  code       String
  legCarrier Legs   @relation(fields: [carrier_id], references: [id], onDelete: Cascade)
}

model FlightInfo {
  id             Int          @id @default(autoincrement()) // PK
  flight_info_id Int          @unique // FK
  flight_number  String
  carrier_info   CarrierInfo?
  flightLeg      Legs         @relation(fields: [flight_info_id], references: [id], onDelete: Cascade)
}

model CarrierInfo {
  id                Int        @id @default(autoincrement()) // PK
  carrier_info_id   Int        @unique // FK
  operating_carrier String
  carrierFlight     FlightInfo @relation(fields: [carrier_info_id], references: [id], onDelete: Cascade)
}

model PriceBreakdown {
  id             Int             @id @default(autoincrement()) // PK
  total          TotalPrice?
  base_fare      BaseFare?
  tax            Tax?
  discount       Discount?
  flightOffers   FlightOffers[]
  travelerPrices TravelerPrice[]
}

model TotalPrice {
  id                  Int            @id @default(autoincrement()) // PK
  total_price_id      Int            @unique // FK
  currency_code       String
  amount              Int
  totalPricePerFlight PriceBreakdown @relation(fields: [total_price_id], references: [id], onDelete: Cascade)
}

model BaseFare {
  id                 Int            @id @default(autoincrement()) // PK
  base_price_id      Int            @unique // FK
  currency_code      String
  amount             Int
  basePricePerFlight PriceBreakdown @relation(fields: [base_price_id], references: [id], onDelete: Cascade)
}

model Tax {
  id            Int            @id @default(autoincrement()) // PK
  tax_id        Int            @unique // FK
  currency_code String
  amount        Int
  taxPerFlight  PriceBreakdown @relation(fields: [tax_id], references: [id], onDelete: Cascade)
}

model Discount {
  id                Int            @id @default(autoincrement()) // PK
  discount_id       Int            @unique // FK
  currency_code     String
  amount            Int
  discountPerFlight PriceBreakdown @relation(fields: [discount_id], references: [id], onDelete: Cascade)
}

model TravelerPrice {
  id                     Int             @id @default(autoincrement()) // PK
  traveler_price_id      String // FK
  price_id               Int? // FK
  traveler_reference     String
  traveler_type          String
  price_breakdown        PriceBreakdown? @relation(fields: [price_id], references: [id])
  travelerPricePerFlight FlightOffers    @relation(fields: [traveler_price_id], references: [id], onDelete: Cascade)
}

model SeatAvailability {
  id                        Int          @id @default(autoincrement()) // PK
  seat_availability_id      String       @unique // FK
  seats_left                Int
  seatAvailabilityPerFlight FlightOffers @relation(fields: [seat_availability_id], references: [id], onDelete: Cascade)
}

model BrandedFareInfo {
  id                       Int          @id @default(autoincrement()) // PK
  branded_fareinfo_id      String       @unique // FK
  cabin_class              String
  features                 Features[]
  brandedFareInfoPerFlight FlightOffers @relation(fields: [branded_fareinfo_id], references: [id], onDelete: Cascade)
}

model Features {
  id                     Int             @id @default(autoincrement()) // PK
  feature_id             Int // FK
  feature_name           String
  category               String
  availability           String
  featureBrandedFareInfo BrandedFareInfo @relation(fields: [feature_id], references: [id], onDelete: Cascade)
}
