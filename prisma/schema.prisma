// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL") // --- only needed when i want to do migrations and generate that's why the error ---
}

//creating the tables/models i need for my app

model Airport {
  airport_code String             @id
  airport_name String
  image_url    String? // optional field
  city         String
  country      String
  departures   DepartureAirport[]
  arrivals     ArrivalAirport[]
}

model Data {
  id                       String                  @id
  departure_intervals      DepartureInterval[]
  duration_min             Int
  duration_max             Int
  short_layover_connection ShortLayoverConnection?
  min_price                MinPrice?
  baggage                  Baggage[]
  cabin_class              String
  stops                    Stop[]
  airlines                 Airlines[]
  duration                 Duration[]
  flight_times             FlightTimes[]
  flight_offers            FlightOffers[]
}

model DepartureInterval {
  id              Int    @id @default(autoincrement())
  interval_id     String // FK
  start           String
  end             String
  departureFlight Data   @relation(fields: [interval_id], references: [id])
}

model ShortLayoverConnection {
  id            Int    @id @default(autoincrement())
  layover_id    String @unique // FK
  count         Int?
  layoverFlight Data   @relation(fields: [layover_id], references: [id])
}

model MinPrice {
  id                   Int       @id @default(autoincrement())
  min_price_data_id    String    @unique // FK
  min_price_airline_id String    @unique
  min_price_stop_id    Int       @unique
  currency_code        String?
  amount               Int
  minPricePerFlight    Data      @relation(fields: [min_price_data_id], references: [id])
  minPricePerAirline   Airlines? @relation(fields: [min_price_airline_id], references: [id])
  minPricePerStop      Stop?     @relation(fields: [min_price_stop_id], references: [id])
}

model Stop {
  id          Int       @id @default(autoincrement())
  stop_id     String
  no_of_stops Int
  count       Int?
  stopCount   Data      @relation(fields: [stop_id], references: [id])
  min_price   MinPrice?
}

model Airlines {
  id            String    @id @default(uuid())
  airline_id    String    @unique
  name          String
  logo          String
  iata_code     String
  min_price     MinPrice?
  airlineFlight Data      @relation(fields: [airline_id], references: [id])
}

model Duration {
  id             Int    @id @default(autoincrement())
  duration_id    String
  min            Int
  max            Int
  durationFlight Data   @relation(fields: [duration_id], references: [id])
}

model Baggage {
  id            Int     @id @default(autoincrement())
  baggage_id    String
  type          String
  included      Boolean
  weight        Int?
  param_name    String?
  baggageFlight Data    @relation(fields: [baggage_id], references: [id])
}

model FlightTimes {
  id                String    @id @default(uuid())
  flight_times_id   String
  flight_times_data Data      @relation(fields: [flight_times_id], references: [id])
  arrival           Arrival[]
  depart            Depart[]
}

model Arrival {
  id            Int         @id @default(autoincrement())
  arrival_id    String
  start         String
  end           String
  arrival_times FlightTimes @relation(fields: [arrival_id], references: [id])
}

model Depart {
  id           Int         @id @default(autoincrement())
  depart_id    String
  start        String
  end          String
  depart_times FlightTimes @relation(fields: [depart_id], references: [id])
}

model FlightOffers {
  id                String            @id @default(uuid())
  flight_offer_id   String // FK
  token             String
  trip_type         String
  flight_key        String
  segments          Segments[]
  price_breakdown   PriceBreakdown?
  traveler_price    TravelerPrice?
  seat_availability SeatAvailability?
  branded_fareinfo  BrandedFareInfo?
  FlightData        Data              @relation(fields: [flight_offer_id], references: [id])
}

model Segments {
  id                 Int               @id @default(autoincrement())
  segment_id         String // FK
  departure_airports DepartureAirport?
  arrival_airports   ArrivalAirport?
  departure_time     String
  arrival_time       String
  total_time         Int
  legs               Legs[]
  segmentData        FlightOffers      @relation(fields: [segment_id], references: [id])
}

model DepartureAirport {
  id            Int      @id @default(autoincrement())
  depart_id     Int      @unique
  depart_leg_id Int      @unique
  airport_code  String
  airport       Airport  @relation(fields: [airport_code], references: [airport_code])
  departSegment Segments @relation(fields: [depart_id], references: [id])
  departLeg     Legs     @relation(fields: [depart_leg_id], references: [id])
}

model ArrivalAirport {
  id             Int      @id @default(autoincrement())
  arrival_id     Int      @unique
  arrival_leg_id Int      @unique
  airport_code   String
  airport        Airport  @relation(fields: [airport_code], references: [airport_code])
  arrivalSegment Segments @relation(fields: [arrival_id], references: [id])
  arrivalLeg     Legs     @relation(fields: [arrival_leg_id], references: [id])
}

model Legs {
  id                Int               @id @default(autoincrement())
  leg_id            Int               @unique
  departure_time    String
  arrival_time      String
  cabin_class       String
  total_time        Int
  departure_airport DepartureAirport?
  arrival_airport   ArrivalAirport?
  carriers          Carriers[]
  flight_info       FlightInfo?
  legSegment        Segments          @relation(fields: [leg_id], references: [id])
}

model Carriers {
  id         Int    @id @default(autoincrement())
  carrier_id Int    @unique
  name       String
  logo       String
  code       String
  legCarrier Legs   @relation(fields: [carrier_id], references: [id])
}

model FlightInfo {
  id             Int          @id @default(autoincrement())
  flight_info_id Int          @unique
  flight_number  Int
  carrier_info   CarrierInfo?
  flightLeg      Legs         @relation(fields: [flight_info_id], references: [id])
}

model CarrierInfo {
  id                Int        @id @default(autoincrement())
  carrier_info_id   Int        @unique
  operating_carrier String
  carrierFlight     FlightInfo @relation(fields: [carrier_info_id], references: [id])
}

model PriceBreakdown {
  id                 Int           @id @default(autoincrement())
  price_breakdown_id String        @unique
  traveler_price_id  Int           @unique
  total              TotalPrice?
  base_fare          BaseFare?
  tax                Tax?
  discount           Discount?
  priceFlight        FlightOffers  @relation(fields: [price_breakdown_id], references: [id])
  travelerPrice      TravelerPrice @relation(fields: [traveler_price_id], references: [id])
}

model TotalPrice {
  id                  Int            @id @default(autoincrement())
  total_price_id      Int            @unique
  currency_code       String
  amount              Int
  totalPricePerFlight PriceBreakdown @relation(fields: [total_price_id], references: [id])
}

model BaseFare {
  id                 Int            @id @default(autoincrement())
  base_price_id      Int            @unique
  currency_code      String
  amount             Int
  basePricePerFlight PriceBreakdown @relation(fields: [base_price_id], references: [id])
}

model Tax {
  id            Int            @id @default(autoincrement())
  tax_id        Int            @unique
  currency_code String
  amount        Int
  taxPerFlight  PriceBreakdown @relation(fields: [tax_id], references: [id])
}

model Discount {
  id                Int            @id @default(autoincrement())
  discount_id       Int            @unique
  currency_code     String
  amount            Int
  discountPerFlight PriceBreakdown @relation(fields: [discount_id], references: [id])
}

model TravelerPrice {
  id                     Int             @id @default(autoincrement())
  traveler_price_id      String          @unique
  traveler_reference     String
  traveler_type          String
  price_breakdown        PriceBreakdown?
  travelerPricePerFlight FlightOffers    @relation(fields: [traveler_price_id], references: [id])
}

model SeatAvailability {
  id                        Int          @id @default(autoincrement())
  seat_availability_id      String       @unique
  seats_left                Int
  seatAvailabilityPerFlight FlightOffers @relation(fields: [seat_availability_id], references: [id])
}

model BrandedFareInfo {
  id                       Int          @id @default(autoincrement())
  branded_fareinfo_id      String       @unique
  cabin_class              String
  features                 Features[]
  brandedFareInfoPerFlight FlightOffers @relation(fields: [branded_fareinfo_id], references: [id])
}

model Features {
  id                     Int             @id @default(autoincrement())
  feature_id             Int             @unique
  feature_name           String
  category               String
  availability           Boolean
  featureBrandedFareInfo BrandedFareInfo @relation(fields: [feature_id], references: [id])
}
